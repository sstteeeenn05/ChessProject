<html>

<head>
  <script defer type="module" src="PlayRoom.js"></script>
  <link rel="stylesheet" href="PlayRoomStyle.css">
  <title>Playing Chess</title>
</head>

<body>
  <div x-data="{loading : true}">
    <div x-data="globalScope" x-show="!loading"
        x-init="connectGame()" x-cloak>
      <button class="leave-button"
              @click="loading = true;
                      setTimeout(()=>{location.href = 'index.html';}, 1000)">
        <img class="leave-button-image" src="./assets/exit.svg"
             alt="leave">
      </button>

      <div class="board">
        <template x-for="(line, row) in board" :key="row">
          <div class="row">
            <template x-for="(item, column) in line" :key="column">
              <div class="row-element"
                   :style="{background: previewClass[maskBoard[row*8+column]]}"
                   @click="click(column,row)">
                <img class="image" x-show="calculateUrl(item) !== './assets/nothing.png'"
                     :src="calculateUrl(item)" :alt="item"
                     x-transition:enter.duration.500ms x-transition:leave.duration.0s>
              </div>
            </template>
          </div>
        </template>
      </div>
      <div class="bottom-info">
        <button class="undo-button" :disabled="!canUndo" @click="readHistory('undo')">
          <img class="undo-button-image" src="./assets/left.svg" alt="undo">
        </button>
        <h3 class="round-message" x-text="`Now Moving: ${nowMoving}'s turn`"></h3>
        <button class="redo-button" :disabled="!canRedo" @click="readHistory('redo')">
          <img class="redo-button-image" src="./assets/right.svg" alt="undo">
        </button>
      </div>
      <dialog class="lightbox" id="promotion"
              @cancel="(event)=>{event.preventDefault()}"
              x-show="isPromoting" x-transition>
        <h2>Promotion!!!</h2>
        <div class="select-div">
          <template x-for="(item, index) in calculatePromotionChess()" :key="index">
            <div class="promotion-container" @click="promotion(index)">
              <img class="promotion-image" :src="calculateUrl(item)"
                   :alt="item">
            </div>
          </template>
        </div>
      </dialog>
      <dialog class="lightbox" id="messageBox"
              @cancel="(event)=>{event.preventDefault()}"
              x-show="isMessage" x-transition>
        <h2 class="box-title" x-text="boxTitle"></h2>
        <p class="box-content" x-text="boxContext"></p>
        <button class="confirm-button" @click="closeMessage">OK</button>
      </dialog>
    </div>
    <div class="center" x-show="loading" x-transition.duration.500ms>
      <div class="wave" waveid="9"></div>
      <div class="wave" waveid="8"></div>
      <div class="wave" waveid="7"></div>
      <div class="wave" waveid="6"></div>
      <div class="wave" waveid="5"></div>
      <div class="wave" waveid="4"></div>
      <div class="wave" waveid="3"></div>
      <div class="wave" waveid="2"></div>
      <div class="wave" waveid="1"></div>
      <div class="wave" waveid="0"></div>
      <div class="wave" waveid="1"></div>
      <div class="wave" waveid="2"></div>
      <div class="wave" waveid="3"></div>
      <div class="wave" waveid="4"></div>
      <div class="wave" waveid="5"></div>
      <div class="wave" waveid="6"></div>
      <div class="wave" waveid="7"></div>
      <div class="wave" waveid="8"></div>
      <div class="wave" waveid="9"></div>
    </div>
  </div>
</body>

</html>