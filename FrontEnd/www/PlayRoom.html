<html>

<head>
  <script defer type="module" src="PlayRoom.js"></script>
  <link rel="stylesheet" href="PlayRoomStyle.css">
  <link rel="stylesheet" href="lightbox.css">
  <link rel="stylesheet" href="button.css">
  <title>Playing Chess</title>
</head>

<body>
  <div x-data="globalScope">
    <audio id="bgmHead" src="./assets/playRoomHead.mp3" onended="document.querySelector('#bgm').play()"></audio>
    <audio id="bgm" src="./assets/playRoomMain.mp3" onended="document.querySelector('#bgm').play()"></audio>
    <audio id="promoting" src="./assets/promoting.mp3" onended="document.querySelector('#promoting').play()"></audio>
    <audio id="promoted" src="./assets/promoted.mp3" onended="document.querySelector('#bgm').play()"></audio>
    <audio id="rick" src="./assets/rick.mp3" onended="document.querySelector('#rick').play()"></audio>
    <div id="gameArea" x-show="!loading"
        x-init="init()" x-cloak>
      <button class="leave-button"
              @click="loading = true;
                      setTimeout(()=>{location.href = '/';}, 1000)">
        <img class="leave-button-image" src="./assets/exit.svg"
             alt="leave">
      </button>

      <div class="left-info">
        <div>
          <p><b>Black</b></p>
          <p x-show="p1Name">PlayerName : <i x-text="p1Name"></i></p>
          <p>RemainTime : <span x-text="Math.floor(blackRemainTime/60)"></span>:<span x-text="blackRemainTime%60==0?'00':blackRemainTime%60"></span></p>
        </div>
        <div>
          <p><b>White</b></p>
          <p x-show="p0Name">PlayerName : <i x-text="p0Name"></i></p>
          <p>RemainTime : <span x-text="Math.floor(whiteRemainTime/60)"></span>:<span x-text="whiteRemainTime%60==0?'00':whiteRemainTime%60"></span></p>
        </div>
        <div x-show="haveMusic===true">
          <p><b>Music Volume :</b></p>
          <p><input type="range" min="0" max="100" x-model="musicVolume" x-effect="updateVolume()" /></p>
        </div>
      </div>
      <div class="board">
        <template x-for="(line, row) in board" :key="row">
          <div class="row">
            <template x-for="(item, column) in line" :key="column">
              <div class="row-element"
                   :style="{background: previewClass[maskBoard[row*8+column]]}"
                   @click="click(column,row)">
                <img class="image" x-show="calculateUrl(item) !== './assets/nothing.png'"
                     :src="calculateUrl(item)" :alt="item"
                     :style="{transition:`transform 1s linear`,transform:easterEggStyle?`translate(${Math.random()*100-50}vh,${Math.random()*100-50}vw) rotate(${Math.random()*2-1}turn)`:''}"
                     x-transition:enter.duration.500ms x-transition:leave.duration.0s>
              </div>
            </template>
          </div>
        </template>
      </div>
      <div class="bottom-info">
        <button class="undo-button" x-show="pckg.isSingle" :disabled="!canUndo" @click="readHistory('undo')">
          <img class="undo-button-image" src="./assets/left.svg" alt="undo">
        </button>
        <h3 class="round-message" x-text="roundMessage"></h3>
        <button class="redo-button" x-show="pckg.isSingle" :disabled="!canRedo" @click="readHistory('redo')">
          <img class="redo-button-image" src="./assets/right.svg" alt="undo">
        </button>
      </div>
    </div>
    <div class="center" x-show="loading" x-init="setLoadingDotInterval()" x-transition.duration.500ms>
      <div>
        <div class="waveGroup">
          <div class="wave" waveid="9"></div>
          <div class="wave" waveid="8"></div>
          <div class="wave" waveid="7"></div>
          <div class="wave" waveid="6"></div>
          <div class="wave" waveid="5"></div>
          <div class="wave" waveid="4"></div>
          <div class="wave" waveid="3"></div>
          <div class="wave" waveid="2"></div>
          <div class="wave" waveid="1"></div>
          <div class="wave" waveid="0"></div>
          <div class="wave" waveid="1"></div>
          <div class="wave" waveid="2"></div>
          <div class="wave" waveid="3"></div>
          <div class="wave" waveid="4"></div>
          <div class="wave" waveid="5"></div>
          <div class="wave" waveid="6"></div>
          <div class="wave" waveid="7"></div>
          <div class="wave" waveid="8"></div>
          <div class="wave" waveid="9"></div>
        </div>
        <h2 class="loadingMessage" x-show="loadingMessage" x-text="loadingMessage+loadingDot"></h2>
      </div>
    </div>
    <dialog class="lightbox" id="promotion"
            @cancel="(event)=>{event.preventDefault()}"
            x-show="isPromoting" x-transition>
      <h2 style="text-align: center;margin-top: 0;">Promotion!!!</h2>
      <div class="select-div">
        <template x-for="(item, index) in calculatePromotionChess()" :key="index">
          <div class="promotion-container" @click="promotion(index)">
            <img class="promotion-image" :src="calculateUrl(item)"
                 :alt="item">
          </div>
        </template>
      </div>
    </dialog>
    <dialog class="lightbox" id="messageBox"
            @cancel="(event)=>{event.preventDefault()}"
            x-show="isMessage" x-transition>
      <h2 class="lightbox-title" x-text="boxTitle"></h2>
      <p class="lightbox-content" x-text="boxContext"></p>
      <button class="btn lightbox-button" @click="closeMessage">OK</button>
    </dialog>
    <dialog class="lightbox" id="confirmBox"
            @cancel="(event)=>{event.preventDefault()}"
            x-show="isConfirm" x-transition>
      <h2 class="lightbox-title" x-text="confirmTitle"></h2>
      <p class="lightbox-content" x-text="confirmContext"></p>
      <div style="display: flex;">
        <button class="btn-confirm lightbox-button" @click="closeConfirm(true)">Yes</button>
        <button class="btn-reject lightbox-button" @click="closeConfirm(false)">NO</button>
      </div>
    </dialog>
  </div>
</body>

</html>